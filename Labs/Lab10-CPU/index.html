<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      
        <title>Lab10 CPU - Elementos de Sistemas</title>
      
    
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:700|Oxygen+Mono|Source+Sans+Pro:700|Source+Serif+Pro&amp;display=swap">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script>
      // SETUP GLOBAL CONSTANTS
      var base_url = '../..';
      
      var telemetryEnabled = true;
      var backendUrl = "https://devlife-api.insper-comp.com.br/";
      var courseSlug = "23b-ele";
      
      
      var dashboardEnabled = false;
      var tagTree = {};
      

      // SETUP PLUGIN
      window.initialized = false;
      if (!window.initializers) window.initializers = [];
      window.registerInitializer = (initialize) => {
        if (window.initialized) initialize();
        else window.initializers.push(initialize);
      };
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://unpkg.com/hyperscript.org"></script>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    
    <link rel="stylesheet" href="../../termynal.css">
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  <body>
    <div class="ah-main-container">
      <header class="ah-header">
        <button class="ah-menu-btn ah-button ah-button--borderless"
                aria-label="toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/>
</svg>
        </button>
        <a href="../.."
           title="Elementos de Sistemas"
           class="ah-logo"
           aria-label="Elementos de Sistemas">
          Elementos de Sistemas
        </a>
        <div class="ah-header--right">
          
          
          
          <button id="resetHandoutButton">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
</svg></span>
          </button>
          

          
          <div id="user-menu" hx-get="https://devlife-api.insper-comp.com.br/user-menu" hx-trigger="load"> </div>
          
        </div>
      </header>
      <nav class="ah-navigation preload">
        <div class="ah-nav-container">
          <button class="ah-menu-btn ah-button ah-button--borderless close-menu"
                  aria-label="close menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/>
</svg>
          </button>
          <ul class="ah-nav-body">
            
              
  
    <li>
      <a href="../..">Home</a>
    </li>
  

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Informações Gerais</span>
    <ul>
      
        
  
    <li>
      <a href="../../Home/Sobre-Criterios-de-Avaliacao/">Sobre Criterios de Avaliacao</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Home/Sobre-Rubricas/">Sobre Rubricas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Home/Util-Aulas/">Util Aulas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Home/Avaliacoes/">Avaliacoes</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Projetos</span>
    <ul>
      
        
  
    <li>
      <a href="../../Projetos/A-Algebra-Transistores/">A Algebra Transistores</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/B-LogiComb/">B LogiComb</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/C-ula/">C ula</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/D-LogSeq/">D LogSeq</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/E-CPU/">E CPU</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/F-Assembly/">F Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/G-Assembler/">G Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Projetos/H-VM/">H VM</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item opened">
    <span class="ah-togglable-handle">Labs</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab1-A-Transistores/">Lab1 A Transistores</a>
    </li>
  

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Lab 2: Github</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab2.1-Ambiente/">Lab2.1 Ambiente</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab2.2-Ambiente/">Lab2.2 Ambiente</a>
    </li>
  

      
    </ul>
  </li>

      
        
  
    <li>
      <a href="../Lab3-LogiComb-FPGA/">Lab3 LogiComb FPGA</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab4-LogiComb/">Lab4 LogiComb</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab5-ULA/">Lab5 ULA</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab6-Waves/">Lab6 Waves</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab7-ULA/">Lab7 ULA</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab8-Seq/">Lab8 Seq</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab9-PequenaCPU/">Lab9 PequenaCPU</a>
    </li>
  

      
        
  

    <li class="active ah-togglable-item opened">
      <span class="ah-togglable-handle">Lab10 CPU</span>
      <ul>
        
          
            
            
              <li class="ah-toc-item">
                <a href="#controlunit">ControlUnit</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#memory-io">Memory IO</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#cpu">CPU</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#extras">Extras</a>
              </li>
            
        
      </ul>
    </li>
  

      
        
  
    <li>
      <a href="../Lab11-Assembly/">Lab11 Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab12-Assembly/">Lab12 Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab13-Assembly/">Lab13 Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab14-Assembly/">Lab14 Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab15-Assembly-FPGA/">Lab15 Assembly FPGA</a>
    </li>
  

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Lab 16: Assembler</span>
    <ul>
      
        
  
    <li>
      <a href="../Lab16.1-Assembler/">Lab16.1 Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab16.2-Assembler/">Lab16.2 Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab16.3-Assembler/">Lab16.3 Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab16.4-Assembler/">Lab16.4 Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab16.5-Assembler/">Lab16.5 Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../Lab16.6-Assembler/">Lab16.6 Assembler</a>
    </li>
  

      
    </ul>
  </li>

      
        
  
    <li>
      <a href="../Lab17-VM/">Lab17 VM</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Teoria</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Dados/">Teoria Dados</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Aritmetica-Binaria/">Teoria Aritmetica Binaria</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Algebra-Booleana/">Teoria Algebra Booleana</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-CMOS/">Teoria CMOS</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-RTL/">Teoria RTL</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Componentes/">Teoria Componentes</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Aritmetica-Binaria-HW/">Teoria Aritmetica Binaria HW</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-ULA/">Teoria ULA</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Logica-Sequencial/">Teoria Logica Sequencial</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Sequencial-Componentes/">Teoria Sequencial Componentes</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Z01/">Teoria Z01</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Assembly/">Teoria Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Z01-mapadeMemoria/">Teoria Z01 mapadeMemoria</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-nasm-jump/">Teoria nasm jump</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Linguagem-de-Maquina/">Teoria Linguagem de Maquina</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Assembler/">Teoria Assembler</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-Assembler-SymbolTable/">Teoria Assembler SymbolTable</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm/">Teoria vm</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-segmentos/">Teoria vm segmentos</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-jump/">Teoria vm jump</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-funcoes/">Teoria vm funcoes</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/teoria/Teoria-vm-memoria/">Teoria vm memoria</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Teoria/VMtranslator-memoria/">VMtranslator memoria</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Util/Util-Video-Aulas/">Vídeo Aulas (Luciano)</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">VHDL</span>
    <ul>
      
        
  
    <li>
      <a href="../../VHDL/VHDL-basico/">VHDL basico</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-Combinacional/">VHDL Combinacional</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-port-map/">VHDL port map</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-Sequencial/">VHDL Sequencial</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-RTL/">VHDL RTL</a>
    </li>
  

      
        
  
    <li>
      <a href="../../VHDL/VHDL-exemplos/">VHDL exemplos</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Z01</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/z01/z01-Resumo-Assembly/">Resumo Assembly</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/z01/z01-Cheat-Sheet/">Z01.1 Cheat Sheet</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/z01/z01-InstructionSet/">Instruction Set</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/z01/z01-Resumo-VM/">Resumo VM</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Estudo</span>
    <ul>
      
        
  
    <li>
      <a href="https://docs.google.com/spreadsheets/d/1rN_zQqYaVI8PjAhKqEBCmY-_06I0X9dD0RddcI-miJs/edit?usp=sharing">Dados Digitais - 1</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/main/Exercicios/Dados_1.pdf">Dados Digitais - 1 - pdf</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/main/Exercicios/Dados_1_respostas.pdf">Dados Digitais - 1 - respostas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-Dados-2/">Exercicio Dados 2</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/main/Exercicios/Exercicio-Dados-2_resolucao.pdf">Dados Digitais - 2 - respostas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-Algebra-Booleana-1/">Exercicio Algebra Booleana 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-Algebra-Booleana-2/">Exercicio Algebra Booleana 2</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/master/Exercicios/Exercicio-Aritmetica-Booleana.pdf">Handout Aritmetica Booleana</a>
    </li>
  

      
        
  
    <li>
      <a href="https://forms.gle/XMsFCDMYsmz1qUP86">Lógica Sequencial</a>
    </li>
  

      
        
  
    <li>
      <a href="https://github.com/Insper/Z01.1/blob/master/Exercicios/Linguagem_de_maquina.pdf">Linguagem de Máquina</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-CPU-1/">Exercicio CPU 1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Exercicios/Exercicio-CPU-2/">Exercicio CPU 2</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Útil</span>
    <ul>
      
        
  
    <li>
      <a href="../../commum-content/util/Util-Comecando-novo-projeto/">Util Comecando novo projeto</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/util/Util-vixi-sou-scrum/">Util vixi sou scrum</a>
    </li>
  

      
        
  
    <li>
      <a href="../../commum-content/util/Util-vixi-sou-dev/">Util vixi sou dev</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Util/Util-Dicas-Actions/">Util Dicas Actions</a>
    </li>
  

      
        
  
    <li>
      <a href="../../Util-Dicas-GIT.md">Dicas git</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">História</span>
    <ul>
      
        
  
    <li>
      <a href="../../Util/Historia-linux/">Historia linux</a>
    </li>
  

      
    </ul>
  </li>

            
          </ul>
        </div>
      </nav>
      <main class="ah-content ah-typeset">
        
          <div class="ah-title-box">
            <ul class="ah-breadcrumbs">
              
                
                  
                    <li>Labs</li>
                  
                
                <li></li>
            </ul>
            
            
          </div>
          
            <section class="progress-section show">
<h1 id="lab-10-control-unit">Lab 10: Control Unit</h1>
<div class="admonition warning">
<p class="admonition-title">Antes de começar</p>
<!-- Aqui começa o projeto **F-CPU**. ==Vocês devem escolher um novo Mediador== -->
<p>Toda vez que um novo projeto começar será necessário realizar algumas configurações no repositório do grupo, vocês devem seguir para o documento: <a href="https://insper.github.io/Z01.1/Util/Util-Comecando-novo-projeto/"><code>Util/Começando novo Projeto</code></a> e depois voltar para esse lab.</p>
<ul>
<li>Não seguir sem realizar a etapa anterior.</li>
</ul>
</div>
<p>A unidade de controle é o periférico da CPU responsável por decodificar uma instrução (linguagem de máquina) e realizar as modificações necessárias no HW (mux, load, ULA, registradores, PC) a fim de executar tal operação.</p>
<p><a class="glightbox" href="../../figs/G-CPU/controlUnit.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/controlUnit.svg" width="60%" /></a></p>
<p>O <code>control unit</code> controla todos os componentes internos da nossa CPU, é ele que por exemplo seleciona como vai estar os sinais do seletor dos mux (<code>muxALUI/I</code>/<code>muxAM/D</code>, qual operação a ULA irá executar (<code>zr.nx.zy.ny.f.no</code>), onde o dado será salvo (<code>loadD</code>, <code>loadA</code>, <code>writeM</code>, <code>loadPC</code>) e se é para executar uma operação de salto (<code>loadPC</code>). </p>
<p>A figura a baixo ilustra tudo que o <mark>control unit controla</mark>.</p>
<p><a class="glightbox" href="../../figs/G-CPU/cpu-cu.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/cpu-cu.svg" /></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note que os sinais do comparador da ULA: <code>zr</code> e <code>ng</code> também vão para a unidade de controle. É a partir do valor deles que o hardware decide se vai ou não ocorrer uma operação de salto.</p>
</div>
<h2 id="controlunit">ControlUnit</h2>
<p>Vamos implementar partes da unidade de controle. </p>
<h3 id="loadd-exemplo"><code>loadD</code> (exemplo)</h3>
<div class="admonition example">
<p>Exemplo!</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip 1</p>
<p>Utilize o documento <a href="https://insper.github.io/Z01.1/Z01/Util-InstructionSet/"><code>Z01/Instruction Set</code></a> para resolver esse lab.</p>
</div>
<p>O sinal <code>loadD</code> indica quando o registrador <code>D</code> deve armazenar um novo sinal. Para isso, devemos verificar se a instrução em questão que está sendo decodificada pelo 'controlUnit' é do tipo <strong>comando</strong> (C), essa verificação é feita pelo bit mais significativo da instrução (<code>bit17</code>).</p>
<p>Uma vez que detectado uma instrução do tipo C, devemos verificar se o comando que ela representa carrega a operação de salvar em <code>%D</code>, verificamos isso pelo bit <code>d1</code>, que indica se irá ou não ocorrer um carregamento em <code>%D</code>.</p>
<p><a class="glightbox" href="../../figs/G-CPU/loadD.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/loadD.svg" /></a></p>
<p>Com esses dados conseguimos criar a tabela verdade a seguir e extrair a equação que rege esse sinal.</p>
<table>
<thead>
<tr>
<th><code>bit 17</code></th>
<th><code>bit 4</code></th>
<th><code>loadD</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>X</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><mark>1</mark></td>
<td><mark>1</mark></td>
<td><mark>1</mark></td>
</tr>
</tbody>
</table>
<p>Podendo ser traduzido para o código em VHDL (via soma dos produtos):</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">loadD</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">instruction</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">instruction</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>Nesse lab iremos fazer parte do ControlUnit, ele não deve passar em todos os testes.</p>
</blockquote>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Abra o arquivo <code>/Projetos/E-Computador/src/controlUnit.vhd</code></li>
<li>Insira a implementação anterior do <code>loadD</code> na arquitetura</li>
</ol>
</div>
<h3 id="loadm"><code>loadM</code></h3>
<p>Vamos agora implementar o sinal <code>loadM</code>, esse sinal é o que controla se irá ocorrer uma operação de escrita na memória RAM.</p>
<p><a class="glightbox" href="../../figs/G-CPU/cpu-writeM.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/cpu-writeM.svg" width="300" /></a></p>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlUnit.vhd</code></li>
</ol>
</div>
<h3 id="loada"><code>loadA</code></h3>
<p>Agora implemente o <code>loadA</code>, esse sinal que controla o load do registrador A.</p>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlUnit.vhd</code></li>
<li>Teste com o comando <code>./testeHW.py</code></li>
<li>Deve passar nos 7 primeiros testes e, então, apresentar erro.</li>
</ol>
</div>
<h3 id="muxalui_a"><code>muxALUI_A</code></h3>
<p>Esse sinal (<code>muxALUI_A</code>) controla o mux que seleciona qual o sinal que entra no registrador <code>%A</code>, a entrada <code>0</code> do mux é o sinal que sai da ULA e o sinal <code>1</code> do mux são os bits [15..0] da instrução. </p>
<p><a class="glightbox" href="../../figs/G-CPU/cpu-muxALUI.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/cpu-muxALUI.svg" width="300" /></a></p>
<div class="admonition tip">
<p class="admonition-title">Tip 2</p>
<p>Com esse sinal implementando, nossa CPU já suporta a instrução <code>leaw $x, %A</code></p>
</div>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlUnit.vhd</code></li>
<li>Teste com o comando <code>./testeHW.py</code></li>
<li>Deve passar no <mark>TESTE 7</mark> e <mark>TESTE 8</mark></li>
<li>Deve parar para no <mark>TESTE 9</mark></li>
</ol>
</div>
<h3 id="zx"><code>zx</code></h3>
<p>Agora faça o sinal <code>zx</code> que controla o zerador do sinal x da ULA.</p>
<div class="admonition example">
<p class="admonition-title">Implementando e testando</p>
<ol>
<li>Entenda os bits envolvidos</li>
<li>Escreva uma tabela verdade</li>
<li>Encontre a equação e implemente no <code>controlUnit.vhd</code></li>
<li>Teste com o comando <code>./testeHW.py</code></li>
<li>Deve passar no <mark>TESTE 9</mark> e <mark>TESTE 10</mark></li>
<li>Deve parar para no <mark>TESTE 11</mark></li>
</ol>
</div>
<h2 id="memory-io">Memory IO</h2>
<p>O componente <code>memory IO</code> é a 'memória' do nosso computador. Interno nesse módulo possuímos além da memória RAM, outros componentes tais como: tela, chave, leds. Lembrando que para a CPU, não existe separação entre o que é memória e o que é periférico. </p>
<p>Os periféricos internos do <code>memoryIO</code> são:</p>
<ul>
<li>Tela (<code>screen.vhd</code>)<ul>
<li>responsável por controlar o LCD </li>
</ul>
</li>
<li>RAM (<code>ram16k.vhd</code>)<ul>
<li>memória RAM de 16k endereços</li>
</ul>
</li>
<li>SW<ul>
<li>chaves da FPGA</li>
</ul>
</li>
<li>LED<ul>
<li>LEDs da FPGA</li>
</ul>
</li>
</ul>
<p><code>screen</code> e <code>ram16k</code> possuem a interface detalhada a seguir:</p>
<p><a class="glightbox" href="../../figs/G-CPU/memoryIO.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/memoryIO.svg" /></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Os sinais do tipo <code>LCD_</code> da <code>screen</code> são conectados diretamente ao LCD, via <code>portmap</code>.</p>
</div>
<p>O componente <code>memoryIO</code> possui a seguinte entidade:</p>
<p><a class="glightbox" href="../../figs/G-CPU/memoryio-entidade.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../../figs/G-CPU/memoryio-entidade.png" width="200" /></a></p>
<h3 id="estudando">Estudando!</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Discuta, pense e escreva a solução antes de ver a resposta.</p>
</div>
<ol>
<li>
<p>Pense e discuta com seus colegas o <code>memoryIO</code>.</p>
</li>
<li>
<p>Dos sinais de entrada do <code>memoryIO</code> qual define qual periférico (RAM/LCD/SW/LED) será acessado pela CPU? Explique.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<p>O sinal em questão é o <code>address</code>, pois os periféricos são mapeados em endereços diferentes, e é esse sinal que define qual periférico a CPU está querendo acessar. Exemplo: se o sinal <code>address = 1024</code>, a CPU está realizando uma operação na memória RAM, mas se o sinal <code>address = 21184</code> isso indica que a CPU está querendo acessar o <code>LED</code>.</p>
<ul>
<li>Para mais informações, leia <a href="https://insper.github.io/Z01.1/commum-content/teoria/Teoria-Z01-mapadeMemoria/">Teoria/Z01 - Mapa de Memória</a>.</li>
</ul>
</details>
<ol>
<li>Qual sinal informa o <code>memoryIO</code> que a CPU está realizando uma escrita?</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<p>É o <code>writeM</code>, se <code>1</code> indica que a CPU quer realizar uma escrita, caso contrário é uma leitura.</p>
</details>
<ol>
<li>Quais são suas entradas e saídas do LCD que o memoryIO controla? (tudo tirando o que começa com <strong>LCD_</strong>)</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">DISPLAY</span><span class="o">:</span><span class="w"> </span><span class="n">Screen</span><span class="w">  </span><span class="k">port</span><span class="w"> </span><span class="k">map</span><span class="w"> </span><span class="p">(</span>
<span class="w">         </span><span class="n">RST</span><span class="w">          </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">RST</span><span class="p">,</span>
<span class="w">         </span><span class="n">CLK_FAST</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CLK_FAST</span><span class="p">,</span>
<span class="w">         </span><span class="n">CLK_SLOW</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CLK_SLOW</span><span class="p">,</span>

<span class="w">         </span><span class="n">INPUT</span><span class="w">        </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">INPUT</span><span class="p">,</span>
<span class="w">         </span><span class="n">LOAD</span><span class="w">         </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LOAD_DISPLAY</span><span class="p">,</span>
<span class="w">         </span><span class="n">ADDRESS</span><span class="w">      </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ADDRESS</span><span class="p">(</span><span class="mi">13</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">         </span><span class="n">LCD_INIT_OK</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_INIT_OK</span><span class="p">,</span>

<span class="w">         </span><span class="n">LCD_CS_N</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_CS_N</span><span class="w"> </span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_D</span><span class="w">        </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_D</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_RD_N</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_RD_N</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_RESET_N</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_RESET_N</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_RS</span><span class="w">       </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_RS</span><span class="p">,</span>
<span class="w">         </span><span class="n">LCD_WR_N</span><span class="w">     </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LCD_WR_N</span>
<span class="p">);</span>
</code></pre></div>
<ul>
<li><code>input</code>: são os px a serem escritos</li>
<li><code>load</code>: se é para atualizar os px</li>
<li><code>adddress</code>: quais px serão escritos</li>
</ul>
<p>Note que esses sinais são os mesmos sinais de uma memória RAM, porém sem a parte de leitura. O LCD como foi implementando, não suporta que realizemos a leitura de seus pxs.</p>
</details>
<ol>
<li>Como funciona o LED?</li>
</ol>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<details class="info">
<summary>Resposta</summary>
<p>O LED é um endereço da memória, como ele 'armazena' o dado, deve ser implementando com um registrador.</p>
</details>
<ol>
<li>Faça um esboço (diagrama) de como o <code>memoryIO</code> implementará a saída <code>LED</code> </li>
</ol>
<div class="highlight"><pre><span></span><code>         |                                                          |
   LOAD  ---&gt;                                                       |
   ADDRESS -&gt;                                                       |
   INPUT ---&gt;                                                       |
         |                                                          ---&gt; LED
         |                                                          |
         |                                                          |
         |                                                          |
         |                                                          |
</code></pre></div>
<p>Pinos do <code>memoryIO</code>:</p>
<ul>
<li>LOAD: indica escrita</li>
<li>ADDRESS(16 downto 0): endereço da escrita</li>
<li>INPUT(16 downto 0): dado a ser escrito </li>
<li>LED(9 downto 0): Valor dos LEDs da FPGA</li>
</ul>
<h2 id="cpu">CPU</h2>
<p>Proponha uma modificação na <code>CPU</code> do nosso Z01.1 que:</p>
<ol>
<li>Adiciona mais um registrador (<code>%S</code>) (onde é melhor?)</li>
<li>Você teria que modificar a linguagem de máquina do nosso HW. Proponha uma solução.</li>
<li>Possibilita %D endereçar a memória <ul>
<li><code>movw %A, (%D)</code></li>
</ul>
</li>
<li>Possibilite fazer carregamento efetivo em %D<ul>
<li><code>leaw $5, %D</code></li>
</ul>
</li>
</ol>
<p>Para cada modificação faça o desenho da nova CPU.</p>
<h2 id="extras">Extras</h2>
<h3 id="nop"><code>nop</code></h3>
<p>Como o controlUnit controla a CPU para realizar a operação de NOP?</p>
<h3 id="movw-d-a-e-jg-d-ao-mesmo-tempo"><code>movw %D, %A e jg %D</code> ao mesmo tempo</h3>
<p>Nossa CPU suportaria executar simultaneamente a instrução <code>movw %D, %A</code> e ao mesmo tempo a instrução <code>jg %D</code>? </p>
<h3 id="loadpc"><code>loadPC</code></h3>
<p>Quais sinais o influenciam?</p>


</section>
          
        
      </main>
      <footer class="ah-footer ah-typeset">
        <div class="ah-footer-nav">
          
            <a href="../Lab9-PequenaCPU/"
               class="ah-prev"
               title="Lab9 PequenaCPU">
              <span class="nav-label">Previous</span>
              <span class="nav-title">Lab9 PequenaCPU</span>
            </a>
          
          
            <a href="../Lab11-Assembly/"
               class="ah-next"
               title="Lab11 Assembly">
              <span class="nav-label">Next</span>
              <span class="nav-title">Lab11 Assembly</span>
            </a>
          
        </div>
      </footer>
    </div>
    
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="../../termynal.js"></script>
    
  <script>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});</script></body>
</html>